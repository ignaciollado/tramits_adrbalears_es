<form [formGroup]="ayudaForm" (ngSubmit)="onSubmit()" ngClass="form">

<div class="action-buttons">
  <button matButton ngClass="btn-adr btn" (click)="accordion().openAll()">{{ 'XECS.EXPANDALL' | translate }}</button>
  <button matButton ngClass="btn-adr btn" (click)="accordion().closeAll()">{{ 'XECS.COLAPSEALL' | translate }}</button>
</div>
<mat-accordion class="headers-align" multi>
  <mat-expansion-panel [expanded]="step() === 0" (opened)="setStep(0)">
    <mat-expansion-panel-header>
      <mat-panel-title>{{ 'XECS.RGPD' | translate }}</mat-panel-title>
      <mat-panel-description>
         <mat-icon>policy</mat-icon>Condiciones del RGPD y <mat-icon>file_copy</mat-icon>documentación requerida
      </mat-panel-description>
    </mat-expansion-panel-header>

    <section class="rgpd-section">
      <mat-checkbox formControlName="acceptRGPD">
        <label>He leído y acepto la <a href="../../../assets/data/politica_privacidad.html" target="_blank">Política de Privacidad</a>. 
          Los datos personales proporcionados serán tratados por ADR Balears como responsable del tratamiento, con la finalidad de gestionar su solicitud. 
          Puede ejercer sus derechos de acceso, rectificación, supresión y otros, según se detalla en la política de privacidad.<mat-icon (click)="openDialog('300ms', '300ms', 'Sobre el RGDP', '../../../assets/data/clausulaProteccionDatos-es.html', '', '')" style="color: #ff9310;">info</mat-icon>
        </label>
      </mat-checkbox>
    </section>
    <section [innerHTML]="htmlContent"></section>
  </mat-expansion-panel>

  <mat-expansion-panel [disabled]="!rgpdAccepted" [expanded]="rgpdAccepted">
    <mat-expansion-panel-header>
      <mat-panel-title>{{ 'FORM.PROGRAM' | translate }}</mat-panel-title>
      <mat-panel-description>
        Seleccione uno o varios programas de ayuda
        <mat-icon>map</mat-icon>
      </mat-panel-description>
    </mat-expansion-panel-header>
      <section class="checkbox-group">
        <mat-checkbox
          *ngFor="let prog of programas"
          [value]="prog"
          (change)="onCheckboxChange($event)"
          [checked]="ayudaForm.get('opc_programa')?.value.includes(prog)">
          {{ prog }}
        </mat-checkbox>
      </section>
      <mat-error *ngIf="ayudaForm.get('opc_programa')?.invalid && ayudaForm.get('opc_programa')?.touched">
        Debes seleccionar al menos un programa.
      </mat-error>
  </mat-expansion-panel>

  <mat-expansion-panel [disabled]="!rgpdAccepted" [expanded]="rgpdAccepted">
      <mat-expansion-panel-header>
        <mat-panel-title>{{ 'FORM.SOLICITORTYPE' | translate }}</mat-panel-title>
        <mat-panel-description>
          {{ 'FORM.ORGANIZATIONTYPE' | translate }}
        <mat-icon>corporate_fare</mat-icon>
        </mat-panel-description>
      </mat-expansion-panel-header>
      <mat-radio-group aria-label="Select an option" formControlName="tipoSolicitante">
        <mat-radio-button value="autonomo">Autónomo</mat-radio-button>
        <mat-radio-button value="pequenya">Pequeña empresa</mat-radio-button>
        <mat-radio-button value="mediana">Mediana empresa</mat-radio-button>
      </mat-radio-group>
  </mat-expansion-panel>

  <mat-expansion-panel [disabled]="!rgpdAccepted" [expanded]="rgpdAccepted">
      <mat-expansion-panel-header>
      <mat-panel-title>{{ 'FORM.SOLICITOR' | translate }}</mat-panel-title>
      <mat-panel-description>
        Indique algunos datos concretos del interesado
        <mat-icon>person</mat-icon>
      </mat-panel-description>
      </mat-expansion-panel-header>

      <mat-form-field appearance="fill">
        <mat-label>NIF</mat-label>
        <input matInput formControlName="nif" required />
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>{{ 'FORM.SOLICITORNAME' | translate }}</mat-label>
        <input matInput formControlName="denom_interesado" required />
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>{{ 'FORM.ADDRESS' | translate }}</mat-label>
        <input matInput formControlName="domicilio" required />
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>{{ 'FORM.ZIPCODE' | translate }}</mat-label>
        <input matInput formControlName="zipCode" required maxlength="5" minlength="5" [matAutocomplete]="auto" (blur)="selecteZipValue()"/>
          <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayFn">
            <mat-option *ngFor="let option of filteredZipCodes | async" [value]="option">{{option.zipCode}} {{option.town}}</mat-option>
          </mat-autocomplete>        
      </mat-form-field>      

      <mat-form-field appearance="fill">
        <mat-label>{{ 'FORM.TOWN' | translate }}</mat-label>
        <input matInput formControlName="town" />
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>{{ 'FORM.CONTACTPHONE' | translate }}</mat-label>
        <input matInput formControlName="telefono_cont" maxlength="9" minlength="9"/>
      </mat-form-field>
  </mat-expansion-panel>
  
  <mat-expansion-panel [disabled]="!rgpdAccepted" [expanded]="rgpdAccepted">
      <mat-expansion-panel-header>
      <mat-panel-title>{{ 'FORM.NOTIFICATIONCHANEL' | translate }}</mat-panel-title>
      <mat-panel-description>
        <mat-icon>mail</mat-icon>
      </mat-panel-description>
      </mat-expansion-panel-header>
      <mat-form-field appearance="fill">
        <mat-label>{{ 'FORM.NOTIFICATIONMOBILE' | translate }}</mat-label>
        <input matInput formControlName="tel_representante" required maxlength="9" minlength="9" />
      </mat-form-field>
      <mat-form-field appearance="fill">
        <mat-label>{{ 'FORM.NOTIFICATIONMAIL' | translate }}</mat-label>
        <input matInput formControlName="mail_representante" />
      </mat-form-field>
  </mat-expansion-panel>

  <mat-expansion-panel [disabled]="!rgpdAccepted" [expanded]="rgpdAccepted">
    <mat-expansion-panel-header>
      <mat-panel-title>{{ 'FORM.CONSULTANTDATA' | translate }}</mat-panel-title>
      <mat-panel-description>
        <mat-icon>question_mark</mat-icon>
      </mat-panel-description>
    </mat-expansion-panel-header>
      <mat-form-field appearance="fill">
        <mat-label>{{ 'FORM.CONSULTANTCOMPANY' | translate }}</mat-label>
        <input matInput formControlName="empresa_consultor" />
      </mat-form-field>
      <mat-form-field appearance="fill">
        <mat-label>{{ 'FORM.CONSULTANTNAME' | translate }}</mat-label>
        <input matInput formControlName="nom_consultor" />
      </mat-form-field>
      <mat-form-field appearance="fill">
        <mat-label>{{ 'FORM.CONSULTANTPHONE' | translate }}</mat-label>
        <input matInput formControlName="tel_consultor" maxlength="9" minlength="9" />
      </mat-form-field>
      <mat-form-field appearance="fill">
        <mat-label>{{ 'FORM.CONSULTANTMAIL' | translate }}</mat-label>
        <input matInput formControlName="mail_consultor" />
      </mat-form-field>      
  </mat-expansion-panel>

  <mat-expansion-panel [disabled]="!rgpdAccepted" [expanded]="rgpdAccepted">
    <mat-expansion-panel-header>
      <mat-panel-title>{{ 'FORM.ATTACHEDDOCUMENTATION' | translate }}</mat-panel-title>
      <mat-panel-description>
        Indique los documentos que desea enviarnos
        <mat-icon>file_copy</mat-icon>
      </mat-panel-description>
    </mat-expansion-panel-header>

  <section ngClass="memoria-tecnica">
        <mat-form-field appearance="fill" class="full-width">
          <mat-label>{{ 'FILES.SELECTFILESMEMTEC' | translate }}</mat-label>
          <input
            type="text"
            matInput
            [value]="memoriaTecnicaFileNames"
            placeholder="{{ 'FILES.SELECTFILESMEMTEC' | translate }}"
            readonly
            (click)="file_memoriaTecnica.click()"
        />
      </mat-form-field>
      <input
        #file_memoriaTecnica
        type="file"
        (change)="onFileMemoriaTecnicaChange($event)"
        multiple
        accept=".pdf"
        hidden />
      <!-- <button mat-raised-button color="primary" (click)="fileInput.click()">{{ 'FORM.SELECTFILES' | translate }}</button> -->
      <ul *ngIf="file_memoriaTecnicaUploaded.length > 0">
        <li *ngFor="let file of file_memoriaTecnicaUploaded">{{ file.name }}</li>
      </ul>
  </section>
  <mat-form-field appearance="fill">
    <mat-label>{{ 'FORM.BANKNAME' | translate }}</mat-label>
    <input matInput formControlName="nom_entidad" />
  </mat-form-field>
  <mat-form-field appearance="fill">
    <mat-label>{{ 'FORM.BANKADDRESS' | translate }}</mat-label>
    <input matInput formControlName="domicilio_sucursal" />
  </mat-form-field>
  <mat-form-field appearance="fill">
    <mat-label>{{ 'FORM.BANKBICSWIFT' | translate }}</mat-label>
    <input matInput formControlName="codigo_BIC_SWIFT" />
  </mat-form-field>
  <mat-radio-group aria-label="Select an option" formControlName="opcion_banco">
    <mat-radio-button value="1">Opciò 1 - IBAN del compte per a Espanya</mat-radio-button>
    <mat-radio-button value="2">Opciò 2 - Número del compte d'altres països</mat-radio-button>
  </mat-radio-group>
  <mat-form-field appearance="fill">
    <mat-label>{{ 'FORM.BANKCC' | translate }}</mat-label>
    <input matInput formControlName="cc" />
  </mat-form-field>    
  <section ngClass="certificado-iae">
      <mat-form-field appearance="fill" class="full-width">
          <mat-label>{{ 'FILES.SELECTFILESCERTIAE' | translate }}</mat-label>
          <input
            type="text"
            matInput
            [value]="certificadoIAEFileNames"
            placeholder="{{ 'FILES.SELECTFILESCERTIAE' | translate }}"
            readonly
            (click)="file_certificadoIAE.click()"/>
      </mat-form-field>
      <input
        #file_certificadoIAE
        type="file"
        (change)="onFileCertificadoIAEChange($event)"
        multiple
        accept=".pdf"
        hidden />
      <!-- <button mat-raised-button color="primary" (click)="fileInput.click()">{{ 'FORM.SELECTFILES' | translate }}</button> -->
      <ul *ngIf="file_certificadoIAEUploaded.length > 0">
        <li *ngFor="let file of file_certificadoIAEUploaded">{{ file.name }}</li>
      </ul>
  </section>
  <section ngClass="copia-nif">
      <mat-form-field appearance="fill" class="full-width">
          <mat-label>{{ 'FILES.SELECTFILESNIF' | translate }}</mat-label>
          <input
            type="text"
            matInput
            [value]="nifEmpresaFileNames"
            placeholder="{{ 'FILES.SELECTFILESNIF' | translate }}"
            readonly
            (click)="file_nifEmpresa.click()"/>
      </mat-form-field>
      <input
        #file_nifEmpresa
        type="file"
        (change)="onFileNifEmpresaChange($event)"
        multiple
        accept=".pdf"
        hidden />
      <!-- <button mat-raised-button color="primary" (click)="fileInput.click()">{{ 'FORM.SELECTFILES' | translate }}</button> -->
      <ul *ngIf="file_nifEmpresaUploaded.length > 0">
        <li *ngFor="let file of file_nifEmpresaUploaded">{{ file.name }}</li>
      </ul>
  </section> 
  </mat-expansion-panel>  
   
  <mat-expansion-panel [disabled]="!rgpdAccepted" [expanded]="rgpdAccepted">
    <mat-expansion-panel-header>
      <mat-panel-title>{{ 'FORM.AUTORIZATIONS' | translate }}</mat-panel-title>
      <mat-panel-description>
        Autorizaciones
        <mat-icon>license</mat-icon>
      </mat-panel-description>
    </mat-expansion-panel-header>
      <section class="checkbox-group">
        <mat-checkbox
          *ngFor="let author of authorizations"
          [value]="author"
          (change)="onCheckboxChange($event)"
          [checked]="ayudaForm.get('opc_authorrama')?.value.includes(author)">
          {{ author }}
        </mat-checkbox>
      </section>
  </mat-expansion-panel>

  <mat-expansion-panel [disabled]="!rgpdAccepted" [expanded]="rgpdAccepted">
     <mat-expansion-panel-header>
      <mat-panel-title>{{ 'FORM.RESPONSIBLEDECLARATION' | translate }}</mat-panel-title>
      <mat-panel-description>
        Declaración responsable
        <mat-icon>license</mat-icon>
      </mat-panel-description>
    </mat-expansion-panel-header>   
      <section class="checkbox-group">
        <mat-checkbox
          *ngFor="let responsibleDeclaration of responsibleDeclarations"
          [value]="responsibleDeclaration"
          (change)="onCheckboxChange($event)"
          [checked]="ayudaForm.get('opc_responsibleDeclarationrama')?.value.includes(responsibleDeclaration)">
          {{ responsibleDeclaration }}
        </mat-checkbox>
      </section>
  </mat-expansion-panel>
</mat-accordion>
<button mat-raised-button color="accent" type="submit" [disabled]="ayudaForm.invalid">{{ 'FORM.SEND' | translate }}</button>
</form>
